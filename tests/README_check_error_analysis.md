# Analysis of `_check_error()` Function

## Summary

The `_check_error()` function in `python/bellhop/bellhop.py` has been analyzed and comprehensive tests have been added. The function's logic is **correct and well-designed** for its purpose.

## Function Purpose

The function parses BELLHOP's `.prt` output files to detect fatal errors generated by the Fortran ERROUT subroutine (in `fortran/FatalError.f90`).

## Logic Analysis

The function implements a simple but effective state machine:

1. **Normal state**: Scans lines for "*** FATAL ERROR ***" marker
2. **Error accumulation state**: Once error detected, accumulates all subsequent lines with [BELLHOP] prefix
3. **File handling**: Gracefully handles missing .prt files (returns None)

## Three Branches Tested

1. **FileNotFoundError branch**: When `.prt` file doesn't exist
2. **Fatal error detection branch**: When "*** FATAL ERROR ***" marker is found
3. **Error continuation branch**: Accumulating subsequent error lines

## Minor Improvement Applied

- Removed unused `lno` variable in the for loop (line number was enumerated but never used)

## Test Coverage

- Added `tests/test_check_error.py` with 7 comprehensive unit tests
- Added `tests/test_check_error_integration.py` with 2 integration tests
- Achieved 100% line coverage of the `_check_error()` function
- All tests pass and validate the function works correctly in all scenarios

## Conclusion

The original function logic was **sound and appropriate**. The only "funny" aspect was the unused `lno` variable, which has been cleaned up. The error detection mechanism correctly follows BELLHOP's error reporting format and provides useful error messages to users.